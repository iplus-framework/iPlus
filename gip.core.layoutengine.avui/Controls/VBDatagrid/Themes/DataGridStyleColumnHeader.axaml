<ResourceDictionary
   xmlns="https://github.com/avaloniaui"
   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
   xmlns:collections="using:Avalonia.Collections"
   xmlns:local="clr-namespace:gip.core.layoutengine.avui">

  <ControlTheme x:Key="ColumnHeaderGripperStyle" TargetType="Thumb">
    <Setter Property="Width" Value="8"/>
    <Setter Property="Background" Value="Transparent"/>
    <Setter Property="Cursor" Value="SizeWestEast"/>
    <Setter Property="Template">
      <ControlTemplate>
        <Border Padding="{TemplateBinding Padding}"
                Background="{TemplateBinding Background}"/>
      </ControlTemplate>
    </Setter>
  </ControlTheme>

  <ControlTheme x:Key="ColumnHeaderStyle" TargetType="DataGridColumnHeader">
    <Setter Property="MinHeight" Value="{StaticResource cellHeight}" />
    <Setter Property="VerticalContentAlignment" Value="Center" />
    <Setter Property="Padding" Value="4,4,5,4" />
    <Setter Property="Foreground" Value="Black" />
    <Setter Property="HorizontalContentAlignment" Value="Center" />
    <Setter Property="FontWeight" Value="Bold" />
    <Setter Property="IsTabStop" Value="False" />
    <Setter Property="SeparatorBrush" Value="#FFC9CACA" />
    <Setter Property="AreSeparatorsVisible" Value="True" />
    <Setter Property="Background" Value="{StaticResource NormalBrush}" />
    <Setter Property="Template">
      <ControlTemplate>
        <Border x:Name="HeaderBorder"
                Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="{TemplateBinding BorderThickness}"
                CornerRadius="{TemplateBinding CornerRadius}">
          <Grid Name="PART_ColumnHeaderRoot" ColumnDefinitions="*,Auto">

            <!-- Background rectangles for styling -->
            <Rectangle x:Name="BackgroundRectangle" Grid.ColumnSpan="2"
                       Fill="{StaticResource NormalBrush}"
                       Stretch="Fill"
                       Stroke="{StaticResource NormalBorderBrush}" 
                       StrokeThickness="1" />
            
            <Rectangle x:Name="HoverRectangle"
                       Grid.ColumnSpan="2" 
                       Stretch="Fill"
                       Fill="{StaticResource HoverShineBrush}"
                       Opacity="0" />

            <Rectangle x:Name="ShineRectangle"
                       Fill="{StaticResource ShineBrush}"
                       Stretch="Fill"
                       Stroke="{StaticResource NormalBorderBrush}"
                       StrokeThickness="1" 
                       Grid.ColumnSpan="2" />

            <!-- Main content area -->
            <Panel Grid.Column="0" 
                   Margin="{TemplateBinding Padding}"
                   HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                   VerticalAlignment="{TemplateBinding VerticalContentAlignment}">
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                  <RowDefinition />
                  <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ContentPresenter x:Name="PART_ContentPresenter"
                                  Grid.Column="0"
                                  Content="{TemplateBinding Content}"
                                  ContentTemplate="{TemplateBinding ContentTemplate}"
                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />

                <TextBlock x:Name="PART_TextBlockSum" 
                           Width="Auto" 
                           Grid.ColumnSpan="2" 
                           FontWeight="Medium"
                           Grid.Row="1" 
                           HorizontalAlignment="Right" 
                           Margin="0,0,4,0" 
                           VerticalAlignment="Center"
                           IsVisible="{Binding SumVisibility, RelativeSource={RelativeSource AncestorType={x:Type local:VBDataGrid}}}"/>

                <Path x:Name="SortArrow"
                      HorizontalAlignment="Left" 
                      VerticalAlignment="Center" 
                      Width="8" 
                      IsVisible="False"
                      Grid.Column="1"
                      Fill="{StaticResource GlyphBrush}"
                      Stretch="Uniform"
                      Data="F1 M -5.215,6.099L 5.215,6.099L 0,0L -5.215,6.099 Z ">
                  <Path.RenderTransform>
                    <ScaleTransform ScaleX=".9" ScaleY=".9" />
                  </Path.RenderTransform>
                </Path>
              </Grid>
            </Panel>

            <!-- Separator -->
            <Rectangle Name="VerticalSeparator"
                       Grid.Column="1"
                       Width="1"
                       VerticalAlignment="Stretch"
                       Fill="{TemplateBinding SeparatorBrush}"
                       IsVisible="{TemplateBinding AreSeparatorsVisible}" />

            <!-- Focus visual -->
            <Grid x:Name="FocusVisual" 
                  IsHitTestVisible="False"
                  IsVisible="False"
                  Grid.ColumnSpan="2">
              <Rectangle x:Name="FocusVisualPrimary"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Stretch"
                         Fill="Transparent"
                         IsHitTestVisible="False"
                         Stroke="{StaticResource DataGridLineBrush}"
                         StrokeThickness="2" />
              <Rectangle x:Name="FocusVisualSecondary"
                         Margin="2"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Stretch"
                         Fill="Transparent"
                         IsHitTestVisible="False"
                         Stroke="{StaticResource DataGridLineBrush}"
                         StrokeThickness="1" />
            </Grid>

            <!-- Column resize grippers - positioned outside main grid -->
            <Thumb x:Name="PART_LeftHeaderGripper"
                   HorizontalAlignment="Left"
                   Theme="{StaticResource ColumnHeaderGripperStyle}"/>
            <Thumb x:Name="PART_RightHeaderGripper"
                   HorizontalAlignment="Right"
                   Theme="{StaticResource ColumnHeaderGripperStyle}"/>
          </Grid>
        </Border>
      </ControlTemplate>
    </Setter>

    <!-- Pseudo-class styles replacing WPF triggers -->
    <Style Selector="^:focus-visible /template/ Grid#FocusVisual">
      <Setter Property="IsVisible" Value="True" />
    </Style>

    <Style Selector="^:pointerover /template/ Rectangle#HoverRectangle">
      <Setter Property="Opacity" Value="1" />
    </Style>

    <Style Selector="^:pressed /template/ Grid#PART_ColumnHeaderRoot">
      <Setter Property="Background" Value="{StaticResource HoverShineBrush}" />
    </Style>

    <Style Selector="^:sortascending /template/ Path#SortArrow">
      <Setter Property="IsVisible" Value="True" />
      <Setter Property="RenderTransform">
        <RotateTransform Angle="180" />
      </Setter>
    </Style>

    <Style Selector="^:sortdescending /template/ Path#SortArrow">
      <Setter Property="IsVisible" Value="True" />
    </Style>
  </ControlTheme>

  <ControlTheme x:Key="{x:Type DataGridColumnHeader}" TargetType="DataGridColumnHeader" BasedOn="{StaticResource ColumnHeaderStyle}">
  </ControlTheme>

  <ControlTheme x:Key="{x:Type VBDataGridColumnHeader}" TargetType="VBDataGridColumnHeader" BasedOn="{StaticResource ColumnHeaderStyle}">
  </ControlTheme>

  <!--Style and template for the button in the upper left corner of the DataGrid.-->
  <ControlTheme TargetType="Button" x:Key="DataGridTopLeftColumnHeader">
    <Setter Property="Template">
      <ControlTemplate>
        <Grid x:Name="TopLeftHeaderRoot">
          <Rectangle x:Name="Border"
                     Fill="{StaticResource NormalBrush}"
                     Stroke="{StaticResource NormalBorderBrush}"
                     StrokeThickness="1" />
          
          <Polygon x:Name="Arrow"
                   HorizontalAlignment="Right"
                   Margin="8,8,3,3"
                   Opacity="0.15"
                   Points="0,10 10,10 10,0"
                   Stretch="Uniform"
                   VerticalAlignment="Bottom"
                   Fill="{StaticResource GlyphBrush}" />
        </Grid>
      </ControlTemplate>
    </Setter>

    <!-- Pseudo-class styles for button states -->
    <Style Selector="^:pointerover /template/ Rectangle#Border">
      <Setter Property="Fill" Value="{StaticResource HoverShineBrush}" />
    </Style>

    <Style Selector="^:pressed /template/ Rectangle#Border">
      <Setter Property="Fill" Value="{StaticResource HoverShineBrush}" />
    </Style>

    <Style Selector="^:disabled /template/ Polygon#Arrow">
      <Setter Property="IsVisible" Value="False" />
    </Style>
  </ControlTheme>

</ResourceDictionary>
